@model EticaretApp.Models.Product
@{
    ViewData["Title"] = Model.Name;
    var relatedProducts = ViewBag.RelatedProducts as List<EticaretApp.Models.Product>;
}

<div class="row mb-5">
    <div class="col-md-6">
        @if (!string.IsNullOrEmpty(Model.ImageUrl))
        {
            <div class="position-relative" style="border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);">
                <img src="@Model.ImageUrl" class="img-fluid w-100" alt="@Model.Name" style="display: block;">
            </div>
        }
        else
        {
            <div class="bg-gradient d-flex align-items-center justify-content-center rounded" 
                 style="height: 400px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px;">
                <span class="text-white" style="font-size: 1.5rem;">üì∑ Resim Yok</span>
            </div>
        }
    </div>
    <div class="col-md-6">
        <div class="mb-3">
            <span class="badge bg-primary" style="font-size: 1rem; padding: 0.5rem 1rem;">@Model.Category?.Name</span>
        </div>
        <h1 class="mb-3" style="font-weight: bold; color: #333;">@Model.Name</h1>
        <div class="mb-4">
            <h2 class="text-primary mb-2" style="font-size: 2.5rem; font-weight: bold;">@Model.Price.ToString("C")</h2>
            @if (!string.IsNullOrEmpty(Model.Size))
            {
                <span class="badge bg-secondary mb-2" style="font-size: 1.2rem;">Beden: @Model.Size</span>
            }
        </div>
        <div class="mb-4">
            <p style="font-size: 1.1rem; line-height: 1.8; color: #555;">@Model.Description</p>
        </div>
        <div class="mb-4 p-3" style="background: #f8f9fa; border-radius: 15px;">
            <p class="mb-2"><strong>Stok Durumu:</strong></p>
            @if (Model.Stock > 0)
            {
                <span class="badge bg-success" style="font-size: 1rem; padding: 0.5rem 1rem;">
                    ‚úÖ @Model.Stock adet mevcut
                </span>
            }
            else
            {
                <span class="badge bg-danger" style="font-size: 1rem; padding: 0.5rem 1rem;">
                    ‚ùå Stokta yok
                </span>
            }
        </div>
        
        @if (User.Identity?.IsAuthenticated == true)
        {
            @if (Model.Stock > 0)
            {
                <div class="mb-4">
                    <label for="quantity" class="form-label" style="font-weight: 600; font-size: 1.1rem;">Miktar:</label>
                    <input type="number" id="quantity" class="form-control" value="1" min="1" max="@Model.Stock" 
                           style="width: 150px; font-size: 1.1rem; font-weight: 600; text-align: center;">
                </div>
                <button class="btn btn-primary btn-lg w-100" onclick="addToCart(@Model.Id)" style="padding: 1rem 2rem; font-size: 1.2rem;">
                    üõí Sepete Ekle
                </button>
            }
            else
            {
                <button class="btn btn-secondary btn-lg w-100" disabled style="padding: 1rem 2rem; font-size: 1.2rem;">
                    ‚ö†Ô∏è Stokta Yok
                </button>
            }
        }
        else
        {
            <a asp-controller="Account" asp-action="Login" class="btn btn-primary btn-lg w-100" style="padding: 1rem 2rem; font-size: 1.2rem;">
                üîê Sepete Eklemek i√ßin Giri≈ü Yapƒ±n
            </a>
        }
    </div>
</div>

@if (relatedProducts != null && relatedProducts.Any())
{
    <hr class="my-5" style="border: none; border-top: 2px solid #e0e0e0;">
    <div class="mb-4">
        <h3 class="text-center mb-4">‚ú® ƒ∞lgili √úr√ºnler</h3>
        <p class="text-center text-muted">Size √∂zel se√ßilmi≈ü √ºr√ºnler</p>
    </div>
    <div class="row">
        @foreach (var product in relatedProducts)
        {
            <div class="col-md-3 mb-4">
                <div class="card h-100">
                    @if (!string.IsNullOrEmpty(product.ImageUrl))
                    {
                        <img src="@product.ImageUrl" class="card-img-top" alt="@product.Name" style="height: 200px; object-fit: cover;">
                    }
                    else
                    {
                        <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center" style="height: 200px;">
                            <span class="text-white">Resim Yok</span>
                        </div>
                    }
                    <div class="card-body d-flex flex-column">
                        <h6 class="card-title">@product.Name</h6>
                        <p class="card-text text-primary mb-3" style="font-size: 1.2rem; font-weight: bold;">@product.Price.ToString("C")</p>
                        <div class="mt-auto">
                            <a asp-action="Details" asp-route-id="@product.Id" class="btn btn-outline-primary w-100">Detaylarƒ± G√∂r</a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}

@section Scripts {
    <script>
        function addToCart(productId) {
            var quantity = document.getElementById('quantity').value;
            
            fetch('/Cart/AddToCart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ productId: productId, quantity: parseInt(quantity) })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Ba≈üarƒ± mesajƒ± g√∂ster
                    showNotification(data.message, 'success');
                    // Sepet sayƒ±sƒ±nƒ± g√ºncelle
                    if (typeof updateCartCount === 'function') {
                        updateCartCount();
                    }
                } else {
                    showNotification(data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Bir hata olu≈ütu.', 'error');
            });
        }

        function showNotification(message, type) {
            // Mevcut bildirimleri kaldƒ±r
            const existing = document.querySelector('.custom-notification');
            if (existing) {
                existing.remove();
            }

            // Yeni bildirim olu≈ütur
            const notification = document.createElement('div');
            notification.className = 'custom-notification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 15px;
                color: white;
                font-weight: 600;
                z-index: 9999;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                animation: slideInRight 0.5s ease;
                max-width: 400px;
            `;
            
            if (type === 'success') {
                notification.style.background = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
                notification.innerHTML = '‚úÖ ' + message;
            } else {
                notification.style.background = 'linear-gradient(135deg, #eb3349 0%, #f45c43 100%)';
                notification.innerHTML = '‚ùå ' + message;
            }
            
            document.body.appendChild(notification);
            
            // 3 saniye sonra kaldƒ±r
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        // CSS animasyonlarƒ± ekle
        const style = document.createElement('style');
        style.textContent = `
            @@keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @@keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

    </script>
}

